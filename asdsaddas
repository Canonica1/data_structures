#include <bits/stdc++.h>
using namespace std;

using ll = long long;
#define ld long double
#define int long long
#define sz(x) (int)(x).size()
#define all(a) (a).begin(), (a).end()
#define rall(a) (a).rbegin(), (a).rend()
#define gen(a, b) uniform_int_distribution<int>(a, b)(rnd)
template<typename T, typename U> bool imin(T& a, U b){if (a > b) {a = b;return true;} return false;}
template<typename T, typename U> bool imax(T& a, U b){if (a < b){a = b; return true;} return false;}
#define F_OR(i, a, b, s) for (int i=(a); (s)>0?i<(b):i>=(b); i+=(s))
#define F_OR1(e) F_OR(i, 0, e, 1)
#define F_OR2(i, e) F_OR(i, 0, e, 1)
#define F_OR3(i, b, e) F_OR(i, b, e, 1)
#define F_OR4(i, b, e, s) F_OR(i, b, e, s)
#define GET5(a, b, c, d, e, ...) e
#define F_ORC(...) GET5(__VA_ARGS__, F_OR4, F_OR3, F_OR2, F_OR1)
#define FOR(...) F_ORC(__VA_ARGS__)(__VA_ARGS__)

const int INF = 1e18;
int mod = 1e9 + 7;
const ld EPS = 1e-6;
mt19937 rnd(chrono::steady_clock::now().time_since_epoch().count());
#ifndef ONPC
#define endl '\n'
#endif
vector<int>rem(vector<int> a, int j) {
    vector<int> nn;
    for(int i = 0; i < a.size(); i++) {
        if(i == j) continue;
        nn.push_back(a[i]);
    }
    return nn;
}
void solve(){
    int n,q;
    cin >>n >> q;
    vector<int> a(n);
    iota(all(a), 1);
    int A = 0;
    for(int i = 0; i < q; i++) {
        int t;
        cin >> t;
        if(t == 1) {
            int x,y;
            cin >> x >> y;
           // x-=A;
            //y -= A;
            for(int j = 0; j < n; j++) {
                if(a[j] == x) {
                    cout << j + 1 << endl;
                    A = j + 1;
                    a[j] = y;
                    break;
                }
            }
        } else if(t == 2) {
            int x;
            cin >> x;
            //x-=A;

            vector<int> sii,sii2;
            for(int j = 0; j < n; j++) {
                if(a[j] == x) {
                    cout << j + 1 << endl;
                    A = j + 1;
                    sii2 = rem(a,j);
                    sii.push_back(a[j]);
                    for(auto xx : sii2) {
                        sii.push_back(xx);
                    }
                    break;
                }
            }
            a = sii;
        } else if(t == 3) {
            int x;
            cin >> x;
           // x-=A;

            vector<int> sii;
            for(int j = 0; j < n; j++) {
                if(a[j] == x) {
                    cout << j + 1 << endl;
                    A = j + 1;
                    sii = rem(a,j);
                    sii.push_back(a[j]);
                    break;
                }
            }
            a = sii;
        } else {
            int x;
            cin >> x;
            //x -= A;
            cout << a[x - 1] << endl;
            A = a[x - 1];
        }
    }
}

signed main() {
    ios::sync_with_stdio(0);
    cin.tie(0);
#ifdef ONPC
    freopen("test.txt", "r", stdin);
#endif
    int tt = 1;
    while(tt--) solve();
}
